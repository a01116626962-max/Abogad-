<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุฅุฑุณุงู ุญุถูุฑ ุจููุฑุฉ ุชููุงุฆู</title>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f4f9;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
}
.box {
    background:#fff;
    padding:30px;
    border-radius:10px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
    font-size:16px;
}
</style>
</head>
<body>

<div class="box">
โณ ุฌุงุฑู ุชุฌููุฒ ุฑุณุงูุฉ ุญุถูุฑ ุจููุฑุฉ ุชููุงุฆููุง...
</div>

<script>
// ----- Firebase Config -----
firebase.initializeApp({
    apiKey: "AIzaSyCDJANXMfd6TR7R2ruLIi-xytlrB-LiCEs",
    authDomain: "rdtt-15cbe.firebaseapp.com",
    projectId: "rdtt-15cbe"
});
const db = firebase.firestore();

// ----- ุจูุงูุงุช ุงููุชุทูุนูู -----
const WORKING_DAYS = ["ุงูุณุจุช","ุงูุฃุญุฏ","ุงูุฅุซููู","ุงูุซูุงุซุงุก","ุงูุฃุฑุจุนุงุก","ุงูุฎููุณ"];
const FIXED_VOLUNTEERS = {
    "ุฃุญูุฏ": WORKING_DAYS,
    "ูุฏูุฑ": WORKING_DAYS,
    "ูุญูุฏ ุฅุจุฑุงููู": WORKING_DAYS,
    "ูุญูุฏ ุนุจุฏุงูุญููุฏ": WORKING_DAYS,
    "ุณุงูู": ["ุงูุณุจุช","ุงูุฃุญุฏ","ุงูุซูุงุซุงุก"],
    "ููุชุงุฒ": WORKING_DAYS,
    "ุญุจูุจุฉ": WORKING_DAYS,
    "ุฑุญุงุจ": ["ุงูุณุจุช","ุงูุฅุซููู","ุงูุซูุงุซุงุก"],
    "ูุนุงุฐ": ["ุงูุฃุญุฏ","ุงูุซูุงุซุงุก","ุงูุฎููุณ"],
    "ูุงุฒู": WORKING_DAYS,
    "ุฅุจุฑุงููู": WORKING_DAYS,
    "ูุนุชุฒ": WORKING_DAYS
};
const JS_DAY_MAP = {0:"ุงูุฃุญุฏ",1:"ุงูุฅุซููู",2:"ุงูุซูุงุซุงุก",3:"ุงูุฃุฑุจุนุงุก",4:"ุงูุฎููุณ",5:"ุงูุฌูุนุฉ",6:"ุงูุณุจุช"};

// ----- ุฏูุงู ูุณุงุนุฏุฉ -----
function formatKey(d){ return d.toISOString().split('T')[0]; }

// ----- ุงูุชูููุฐ ุงูุฑุฆูุณู -----
async function run(){
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate()+1);
    tomorrow.setHours(0,0,0,0);

    const dayName = JS_DAY_MAP[tomorrow.getDay()];
    if(!WORKING_DAYS.includes(dayName)){
        document.querySelector(".box").innerText = "โ ุจููุฑุฉ ูุด ููู ุนูู";
        return;
    }

    const dateKey = formatKey(tomorrow);

    // ุฌูุจ ุฌููุน ุณุฌูุงุช ุงูุญุถูุฑ
    const snapshot = await db.collection("user_attendance").get();
    const lastStatus = {};

    snapshot.forEach(doc=>{
        const d = doc.data();
        if(d.dateKey === dateKey){
            lastStatus[d.volunteerName] = d.status;
        }
    });

    // ุชุญุฏูุฏ ุงูุญุงุถุฑูู
    const finalList = [];
    Object.keys(FIXED_VOLUNTEERS).forEach(name=>{
        const scheduled = FIXED_VOLUNTEERS[name].includes(dayName);
        const status = lastStatus[name];
        if((scheduled && status!=="ุงุนุชุฐุงุฑ") || status==="ุญุถูุฑ"){
            finalList.push(name);
        }
    });

    // ุงูุชุงุฑูุฎ ุจุฏูู ุงุณู ุงูููู ูุชุฌูุจ ุงูุชูุฑุงุฑ
    const arabicDate = tomorrow.toLocaleDateString(
        'ar-EG',
        { year:'numeric', month:'long', day:'numeric' }
    );

    const listText = finalList.length
        ? finalList.map((name,i)=>`${i+1}. ${name}`).join('\n')
        : "ูุง ููุฌุฏ ุญุถูุฑ ูุคูุฏ ููุฐุง ุงูููู.";

    // ุชูููู ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ ุชูุงููุง
    const message = `
๐ ูุงุฆูุฉ ุงูุญุถูุฑ ุงูููููุฉ
๐๏ธ ุงูููู : ${dayName} - ${arabicDate} 
๐ ูุนุงุฏ ุงูุดุบู: ูฃ ุงูุนุตุฑ
๐ฅ ุฅุฌูุงูู ุงููุชุทูุนูู : ${finalList.length}

---
ูุงุฆูุฉ ุงููุชุทูุนูู ุงูุญุงุถุฑูู ุงูููู:
${listText}
`;

    document.querySelector(".box").innerText = "โ ุฌุงุฑู ูุชุญ ูุงุชุณุงุจ...";
    // ูุชุญ ูุงุชุณุงุจ ุจุงูุฑุณุงูุฉ ุงูุฌุงูุฒุฉ
    window.location.href = "https://wa.me/?text=" + encodeURIComponent(message.trim());
}

run();
</script>

</body>
</html>
