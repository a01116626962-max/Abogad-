<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¶ÙˆØ± Ø¨ÙÙƒØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f4f4f9;
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
}
.box {
    background:#fff;
    padding:30px;
    border-radius:10px;
    text-align:center;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
    font-size:16px;
}
</style>
</head>

<body>

<div class="box">
    â³ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø±Ø³Ø§Ù„Ø© Ø­Ø¶ÙˆØ± Ø¨ÙÙƒØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...
</div>

<script>
// ----- Firebase Config -----
firebase.initializeApp({
    apiKey: "AIzaSyCDJANXMfd6TR7R2ruLIi-xytlrB-LiCEs",
    authDomain: "rdtt-15cbe.firebaseapp.com",
    projectId: "rdtt-15cbe"
});
const db = firebase.firestore();

// ----- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† -----
const WORKING_DAYS = ["Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³"];
const FIXED_VOLUNTEERS = {
    "Ø£Ø­Ù…Ø¯": WORKING_DAYS,
    "Ù‡Ø¯ÙŠØ±": WORKING_DAYS,
    "Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": WORKING_DAYS,
    "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯": WORKING_DAYS,
    "Ø³Ø§Ù…Ù‰": ["Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"],
    "Ù…Ù…ØªØ§Ø²": WORKING_DAYS,
    "Ø­Ø¨ÙŠØ¨Ø©": WORKING_DAYS,
    "Ø±Ø­Ø§Ø¨": ["Ø§Ù„Ø³Ø¨Øª","Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"],
    "Ù…Ø¹Ø§Ø°": ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³"],
    "Ù…Ø§Ø²Ù†": WORKING_DAYS,
    "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": WORKING_DAYS,
    "Ù…Ø¹ØªØ²": WORKING_DAYS
};
const JS_DAY_MAP = {
    0:"Ø§Ù„Ø£Ø­Ø¯",1:"Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†",2:"Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
    3:"Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡",4:"Ø§Ù„Ø®Ù…ÙŠØ³",5:"Ø§Ù„Ø¬Ù…Ø¹Ø©",6:"Ø§Ù„Ø³Ø¨Øª"
};

// ----- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© -----
function formatKey(d){ return d.toISOString().split('T')[0]; }

// ----- Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -----
async function run(){
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate()+1);
    tomorrow.setHours(0,0,0,0);

    const dayName = JS_DAY_MAP[tomorrow.getDay()];
    if(!WORKING_DAYS.includes(dayName)){
        document.querySelector(".box").innerText = "âŒ Ø¨ÙÙƒØ±Ø© Ù…Ø´ ÙŠÙˆÙ… Ø¹Ù…Ù„";
        return;
    }

    const dateKey = formatKey(tomorrow);

    const snapshot = await db.collection("user_attendance").get();
    const lastStatus = {};

    snapshot.forEach(doc=>{
        const d = doc.data();
        if(d.dateKey === dateKey){
            lastStatus[d.volunteerName] = d.status;
        }
    });

    const finalList = [];
    Object.keys(FIXED_VOLUNTEERS).forEach(name=>{
        const scheduled = FIXED_VOLUNTEERS[name].includes(dayName);
        const status = lastStatus[name];
        if((scheduled && status!=="Ø§Ø¹ØªØ°Ø§Ø±") || status==="Ø­Ø¶ÙˆØ±"){
            finalList.push(name);
        }
    });

    const arabicDate = tomorrow.toLocaleDateString(
        'ar-EG',
        { weekday:'long', year:'numeric', month:'long', day:'numeric' }
    );

    const listText = finalList.length
        ? finalList.map((name,i)=>`${i+1}. ${name}`).join('\n')
        : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¶ÙˆØ± Ù…Ø¤ÙƒØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….";

    const message = `
ğŸ“Œ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
ğŸ—“ï¸ Ø§Ù„ÙŠÙˆÙ… : ${dayName} - ${arabicDate} 
ğŸ•’ Ù…Ø¹Ø§Ø¯ Ø§Ù„Ø´ØºÙ„: Ù£ Ø§Ù„Ø¹ØµØ±
ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† : ${finalList.length}

---
Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† Ø§Ù„Ø­Ø§Ø¶Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…:
${listText}
`;

    document.querySelector(".box").innerText = "âœ… Ø¬Ø§Ø±ÙŠ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨...";
    window.location.href = "https://wa.me/?text=" + encodeURIComponent(message.trim());
}

run();
</script>

</body>
</html>
