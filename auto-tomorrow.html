<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إرسال حضور بُكرة تلقائي</title>
<style>
body {font-family: Arial; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; background:#f4f4f9;}
.box {background:#fff; padding:30px; border-radius:10px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,.1);}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
</head>
<body>

<div class="box">
⏳ جاري تجهيز رسالة حضور بُكرة...
</div>

<script>
// ----- إعداد Firebase -----
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MSG_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ----- بيانات المتطوعين -----
const WORKING_DAYS = ["السبت","الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس"];
const FIXED_VOLUNTEERS = {
    "أحمد": WORKING_DAYS,
    "هدير": WORKING_DAYS,
    "محمد إبراهيم": WORKING_DAYS,
    "محمد عبدالحميد": WORKING_DAYS,
    "سامى": ["السبت","الأحد","الثلاثاء"],
    "ممتاز": WORKING_DAYS,
    "حبيبة": WORKING_DAYS,
    "رحاب": ["السبت","الإثنين","الثلاثاء"],
    "معاذ": ["الأحد","الثلاثاء","الخميس"],
    "مازن": WORKING_DAYS,
    "إبراهيم": WORKING_DAYS,
    "معتز": WORKING_DAYS
};
const JS_DAY_MAP = {0:"الأحد",1:"الإثنين",2:"الثلاثاء",3:"الأربعاء",4:"الخميس",5:"الجمعة",6:"السبت"};

// ----- Unicode للإيموجي -----
const EMOJI = { pin:'\uD83D\uDCCC', calendar:'\uD83D\uDCC5', clock:'\uD83D\uDD52', people:'\uD83D\uDC65' };

// ----- تحديد بُكرة -----
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate()+1);
const dayName = JS_DAY_MAP[tomorrow.getDay()];
const dateKey = `${tomorrow.getFullYear()}-${String(tomorrow.getMonth()+1).padStart(2,'0')}-${String(tomorrow.getDate()).padStart(2,'0')}`;
const arabicDate = tomorrow.toLocaleDateString('ar-EG',{year:'numeric',month:'long',day:'numeric'});

// ----- جلب الحضور من Firebase -----
async function fetchAttendance() {
    try {
        const snapshot = await db.collection("user_attendance").doc(dateKey).get();
        const data = snapshot.exists ? snapshot.data() : {};
        const finalList = Object.keys(FIXED_VOLUNTEERS).filter(name=>{
            // مجدول اليوم أو حضر صريح
            const isScheduled = FIXED_VOLUNTEERS[name].includes(dayName);
            const status = data[name]?.status; // "حضور" أو "اعتذار"
            return (isScheduled && status !== "اعتذار") || status === "حضور";
        });

        const listText = finalList.length
            ? finalList.map((name,i)=>`${i+1}. ${name}`).join('\n')
            : "لا يوجد حضور مؤكد لهذا اليوم.";

        const message = `
${EMOJI.pin} قائمة الحضور اليومية
${EMOJI.calendar} اليوم : ${dayName} - ${arabicDate} 
${EMOJI.clock} معاد الشغل: ٣ العصر
${EMOJI.people} إجمالي المتطوعين : ${finalList.length}

---
قائمة المتطوعين الحاضرين اليوم:
${listText}
`;

        document.querySelector(".box").innerText = "✅ جاري فتح واتساب...";
        window.location.href = "https://wa.me/?text=" + encodeURIComponent(message.trim());
    } catch(e){
        console.error(e);
        document.querySelector(".box").innerText = "❌ حدث خطأ أثناء جلب البيانات!";
    }
}

// ----- تنفيذ -----
fetchAttendance();
</script>

</body>
</html>
