<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ุฑุณุงูุฉ ุญุถูุฑ ุงูููู</title>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

<style>
body{
    font-family: Arial;
    background:#f4f6f8;
    padding:20px;
}
.container{
    max-width:600px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:8px;
}
select, button{
    width:100%;
    margin-top:10px;
    padding:12px;
}
button{
    background:#075E54;
    color:#fff;
    border:none;
    font-size:16px;
}
</style>
</head>

<body>

<div class="container">
<h3>๐ ุฑุณุงูุฉ ุงูุญุถูุฑ ุงูููููุฉ</h3>

<label>ุงุฎุชุฑ ุงูููู</label>
<select id="daySelect">
    <option value="ุงูุณุจุช">ุงูุณุจุช</option>
    <option value="ุงูุฃุญุฏ">ุงูุฃุญุฏ</option>
    <option value="ุงูุฅุซููู">ุงูุฅุซููู</option>
    <option value="ุงูุซูุงุซุงุก">ุงูุซูุงุซุงุก</option>
    <option value="ุงูุฃุฑุจุนุงุก">ุงูุฃุฑุจุนุงุก</option>
    <option value="ุงูุฎููุณ">ุงูุฎููุณ</option>
</select>

<button onclick="prepareMessage()">๐ฒ ุชุฌููุฒ ุฑุณุงูุฉ ูุงุชุณุงุจ</button>
</div>

<script>
// ๐ฅ Firebase
firebase.initializeApp({
    apiKey: "AIzaSyCDJANXMfd6TR7R2ruLIi-xytlrB-LiCEs",
    authDomain: "rdtt-15cbe.firebaseapp.com",
    projectId: "rdtt-15cbe"
});
const db = firebase.firestore();

const JS_DAY_MAP = {
    0:"ุงูุฃุญุฏ",1:"ุงูุฅุซููู",2:"ุงูุซูุงุซุงุก",
    3:"ุงูุฃุฑุจุนุงุก",4:"ุงูุฎููุณ",6:"ุงูุณุจุช"
};

function formatDateKey(date){
    return date.toISOString().split("T")[0];
}

async function prepareMessage(){
    const selectedDay = document.getElementById("daySelect").value;

    const today = new Date();
    while(JS_DAY_MAP[today.getDay()] !== selectedDay){
        today.setDate(today.getDate()+1);
    }

    const dateKey = formatDateKey(today);
    const arabicDate = today.toLocaleDateString('ar-EG',{
        year:'numeric',month:'long',day:'numeric'
    });

    const snapshot = await db.collection("user_attendance").get();

    const attendance = [];

    snapshot.forEach(doc=>{
        const d = doc.data();
        if(d.dateKey === dateKey && d.status === "ุญุถูุฑ"){
            attendance.push(d.volunteerName);
        }
    });

    const list = attendance.length
        ? attendance.map((n,i)=>`${i+1}. ${n}`).join("\n")
        : "ูุง ููุฌุฏ ุญุถูุฑ ูุคูุฏ ููุฐุง ุงูููู.";

    const message = `
๐ ูุงุฆูุฉ ุงูุญุถูุฑ ุงูููููุฉ
๐๏ธ ุงูููู : ${selectedDay} - ${arabicDate}
๐ ูุนุงุฏ ุงูุดุบู: ูฃ ุงูุนุตุฑ
๐ฅ ุฅุฌูุงูู ุงููุชุทูุนูู : ${attendance.length}

---
ูุงุฆูุฉ ุงููุชุทูุนูู ุงูุญุงุถุฑูู ุงูููู:
${list}
`.trim();

    window.open(`https://wa.me/?text=${encodeURIComponent(message)}`,'_blank');
}
</script>

</body>
</html>
