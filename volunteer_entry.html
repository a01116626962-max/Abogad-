<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</title>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· CSS */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: right;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        select, input[type="text"], input[type="time"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
            direction: rtl;
            text-align: right;
        }
        button {
            padding: 12px 20px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #28a745;
            transition: background-color 0.3s;
            font-size: 1.1em;
        }
        button:hover {
            background-color: #218838;
        }
        #response-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #whatsapp-link-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #075E54;
            color: white;
            border-radius: 4px;
            text-align: center;
            display: none;
        }
        #whatsapp-link-container a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            display: block;
            margin-top: 10px;
            padding: 10px;
            background-color: #128C7E;
            border-radius: 4px;
        }
        .apology-fields {
            padding: 15px;
            border: 1px solid #ffc107;
            background-color: #fff3cd;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
</head>
<body>

<div class="container">
    <h1>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</h1>

    <form id="attendance-form">
        
        <label for="volunteer-name">Ø§Ù„Ø§Ø³Ù…:</label>
        <select id="volunteer-name" required>
            <option value="">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ</option>
            </select>

        <label for="registration-type">Ù†ÙˆØ¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:</label>
        <select id="registration-type" onchange="toggleApologyFields()" required>
            <option value="Ø­Ø¶ÙˆØ±">Ø­Ø¶ÙˆØ±</option>
            <option value="Ø§Ø¹ØªØ°Ø§Ø±">Ø§Ø¹ØªØ°Ø§Ø±</option>
        </select>

        <label for="selected-date">Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
        <select id="selected-date" required>
            </select>
        
        <div id="apology-container" class="apology-fields">
            <h4>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±</h4>
            <label for="apology-reason">Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±:</label>
            <input type="text" id="apology-reason" placeholder="Ù…Ø«Ø§Ù„: Ø¸Ø±ÙˆÙ Ø·Ø§Ø±Ø¦Ø©ØŒ Ù…Ø±Ø¶" disabled>
            
            <div id="late-apology-field" style="display:none;">
                <label for="late-reason">Ø³Ø¨Ø¨ ØªØ£Ø®Ø± Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ¹Ø¯):</label>
                <input type="text" id="late-reason" placeholder="Ù…Ø«Ø§Ù„: Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„" disabled>
            </div>
        </div>

        <button type="submit">ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨</button>
    </form>

    <div id="response-message"></div>
    <div id="whatsapp-link-container"></div>
</div>

<script>
    // âš ï¸ Ù…ÙØ§ØªÙŠØ­ Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCDJANXMfd6TR7R2ruLIi-xytlrB-LiCEs", 
        authDomain: "rdtt-15cbe.firebaseapp.com",
        projectId: "rdtt-15cbe",
        storageBucket: "rdtt-15cbe.firebasestorage.app",
        messagingSenderId: "219502671343",
        appId: "1:219502671343:web:b289b11869e25c9a30321a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„ÙŠÙ‡
    const whatsappNumber = "201223314173"; 
    
    // Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ† ÙˆØ£ÙŠØ§Ù… Ø¹Ù…Ù„Ù‡Ù… (Ù…ÙƒØ±Ø±Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙ†Ø§Ø³Ù‚)
    const WORKING_DAYS = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"];

    const FIXED_VOLUNTEERS = {
        "Ø£Ø­Ù…Ø¯": WORKING_DAYS, "Ù‡Ø¯ÙŠØ±": WORKING_DAYS, "Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": WORKING_DAYS, 
        "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯": WORKING_DAYS, "Ø³Ø§Ù…Ù‰": ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"], 
        "Ù…Ù…ØªØ§Ø²": WORKING_DAYS, "Ø­Ø¨ÙŠØ¨Ø©": WORKING_DAYS, "Ø³Ø§Ù†Ø¯ÙŠ": [],
        "Ø±Ø­Ø§Ø¨": ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"], "Ù…Ø¹Ø§Ø°": ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"], 
        "Ù…Ø§Ø²Ù†": WORKING_DAYS, "ÙŠÙˆØ³Ù": [], "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": WORKING_DAYS, 
        "Ù…Ø±ÙˆØ§Ù†": [], "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†": [], "Ù…Ø¹ØªØ²": WORKING_DAYS 
    };

    const JS_DAY_MAP = {
        0: "Ø§Ù„Ø£Ø­Ø¯", 1: "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", 2: "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", 3: "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", 4: "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", 5: "Ø§Ù„Ø®Ù…ÙŠØ³", 6: "Ø§Ù„Ø¬Ù…Ø¹Ø©", 7: "Ø§Ù„Ø³Ø¨Øª"
    };
    
    const MONTH_MAP = [
        "ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", 
        "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"
    ];
    
    /**
     * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ (ÙŠÙˆÙ…_Ø§Ù„Ø´Ù‡Ø± Ø§Ø³Ù…_Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ù†Ø©)
     * @param {Date} date - ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
     * @returns {string} Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù†Ø³Ù‚
     */
    function formatDateDisplay(date) {
        const dayOfWeek = JS_DAY_MAP[date.getDay() === 0 ? 7 : date.getDay()]; // ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø­Ø¯
        const dayOfMonth = date.getDate();
        const monthName = MONTH_MAP[date.getMonth()];
        const year = date.getFullYear();
        
        let display = `${dayOfWeek} (${dayOfMonth} ${monthName} ${year})`;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
            display += " - Ø§Ù„ÙŠÙˆÙ…";
        }
        
        return display;
    }

    /**
     * Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ Ù…ÙØªØ§Ø­ Ø«Ø§Ø¨Øª (YYYY-MM-DD)
     * @param {Date} date - ÙƒØ§Ø¦Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
     * @returns {string} Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù…Ø«Ø§Ù„: 2025-12-08)
     */
     function formatDateKey(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // ----------------------------------------------------------------
    // ÙˆØ¸ÙŠÙØ© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    // ----------------------------------------------------------------

    function initializeForm() {
        const nameSelect = document.getElementById('volunteer-name');
        const dateSelect = document.getElementById('selected-date');
        
        // Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†
        Object.keys(FIXED_VOLUNTEERS).sort().forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            nameSelect.appendChild(option);
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® (Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ + 10 Ø£ÙŠØ§Ù… Ù‚Ø§Ø¯Ù…Ø©)
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 0; i < 11; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            
            const option = document.createElement('option');
            option.value = date.toDateString(); // Ù†Ø³ØªØ®Ø¯Ù… toDateString ÙƒÙ…ÙØªØ§Ø­ ÙØ±ÙŠØ¯
            option.setAttribute('data-date-key', formatDateKey(date)); // Ù…ÙØªØ§Ø­ Ø«Ø§Ø¨Øª YYYY-MM-DD
            option.textContent = formatDateDisplay(date);
            dateSelect.appendChild(option);
        }
    }

    // ----------------------------------------------------------------
    // ÙˆØ¸ÙŠÙØ© Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±
    // ----------------------------------------------------------------
    
    function toggleApologyFields() {
        const type = document.getElementById('registration-type').value;
        const apologyContainer = document.getElementById('apology-container');
        const apologyReason = document.getElementById('apology-reason');
        const lateReason = document.getElementById('late-reason');
        const lateApologyField = document.getElementById('late-apology-field');
        const selectedDateKey = document.getElementById('selected-date').value;
        
        const selectedDateOption = document.querySelector(`#selected-date option[value='${selectedDateKey}']`);
        const selectedDate = selectedDateOption ? new Date(selectedDateOption.value) : new Date();

        // 1. Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±
        if (type === 'Ø§Ø¹ØªØ°Ø§Ø±') {
            apologyContainer.style.display = 'block';
            apologyReason.disabled = false;
            apologyReason.required = true;
        } else {
            apologyContainer.style.display = 'none';
            apologyReason.disabled = true;
            apologyReason.required = false;
            lateReason.disabled = true;
            lateReason.required = false;
        }

        // 2. Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„ØªØ£Ø®Ø±
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        if (type === 'Ø§Ø¹ØªØ°Ø§Ø±' && selectedDate.toDateString() === today.toDateString()) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ø¹ØªØ°Ø§Ø±Ø§Ù‹ Ø¹Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§ÙØªØ±Ø§Ø¶Ø§Ù‹ Ù‡Ùˆ Ù…ØªØ£Ø®Ø±)
            lateApologyField.style.display = 'block';
            lateReason.disabled = false;
            lateReason.required = true;
        } else {
            lateApologyField.style.display = 'none';
            lateReason.disabled = true;
            lateReason.required = false;
        }
    }

    // ----------------------------------------------------------------
    // ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨
    // ----------------------------------------------------------------
    
    document.getElementById('attendance-form').addEventListener('submit', function(e) {
        e.preventDefault();
        registerAttendance();
    });

    async function registerAttendance() {
        const name = document.getElementById('volunteer-name').value;
        const status = document.getElementById('registration-type').value;
        const selectedDateKey = document.getElementById('selected-date').value;
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        const selectedDateOption = document.querySelector(`#selected-date option[value='${selectedDateKey}']`);
        const dateKeyYYYYMMDD = selectedDateOption ? selectedDateOption.getAttribute('data-date-key') : formatDateKey(new Date());
        
        const dateObject = new Date(selectedDateKey);
        const submissionTime = new Date(); // ÙˆÙ‚Øª Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¢Ù†

        let reason = '';
        if (status === 'Ø§Ø¹ØªØ°Ø§Ø±') {
            const apologyReason = document.getElementById('apology-reason').value;
            const lateReason = document.getElementById('late-reason').value;
            reason = apologyReason;
            if (lateReason) {
                reason += ` (ØªØ£Ø®Ø±: ${lateReason})`;
            }
        }
        
        const messageDiv = document.getElementById('response-message');
        const whatsappContainer = document.getElementById('whatsapp-link-container');
        messageDiv.style.display = 'none';
        whatsappContainer.style.display = 'none';
        
        try {
            const docId = `${name}_${dateKeyYYYYMMDD}`;
            
            // ğŸ’¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Firebase
            const dataToSave = {
                volunteerName: name,
                status: status,
                reason: reason,
                // ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡ (ÙˆÙ„ÙŠØ³ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„) Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
                registrationDateTimestamp: firebase.firestore.Timestamp.fromDate(dateObject), 
                // Ù…ÙØªØ§Ø­ ØªØ§Ø±ÙŠØ® Ø«Ø§Ø¨Øª (Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…)
                dateKey: dateKeyYYYYMMDD, 
                // ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù„Ø§Ø­Ø¸Ø§Øª)
                registrationTime: dateObject.toLocaleDateString('ar-EG') + ' â€“ ' + submissionTime.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' }),
                timestamp: firebase.firestore.FieldValue.serverTimestamp() // Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ Ø¯Ù‚ÙŠÙ‚ Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            };

            await db.collection("user_attendance").doc(docId).set(dataToSave, { merge: true });

            messageDiv.className = 'success';
            messageDiv.textContent = 'âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase.';
            messageDiv.style.display = 'block';

            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
            createWhatsAppLink(name, status, dateObject.toLocaleDateString('ar-EG'), submissionTime, reason);

        } catch (error) {
            messageDiv.className = 'error';
            messageDiv.textContent = `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${error.message}`;
            messageDiv.style.display = 'block';
            console.error("Error writing document: ", error);
        }
    }

    // ----------------------------------------------------------------
    // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
    // ----------------------------------------------------------------
    
    function createWhatsAppLink(name, status, dateDisplay, submissionTime, reason) {
        const timeDisplay = submissionTime.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });

        let messageBody = `
ğŸ‘¤ Ø§Ù„Ù…ØªØ·ÙˆØ¹: ${name}
ğŸ“ Ø§Ù„Ø­Ø§Ù„Ø©: **${status}**
ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateDisplay}
ğŸ•’ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${timeDisplay}
`;

        if (status === 'Ø§Ø¹ØªØ°Ø§Ø±') {
            messageBody += `
Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±: ${reason}
`;
        }

        const encodedMessage = encodeURIComponent(messageBody.trim());
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
        
        const container = document.getElementById('whatsapp-link-container');
        container.innerHTML = `
            <p>Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨:</p>
            <a href="${whatsappUrl}" target="_blank">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“²</a>
        `;
        container.style.display = 'block';
    }

    window.onload = function() {
        initializeForm();
        // ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ toggleApologyFields Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        document.getElementById('selected-date').addEventListener('change', toggleApologyFields);
        toggleApologyFields();
    };

</script>

</body>
</html>
