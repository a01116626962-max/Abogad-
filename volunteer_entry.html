<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ¹ÙŠÙ†</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: right;
            direction: rtl;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        select, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 15px;
            color: white;
            background-color: #28a745;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #218838;
        }
        #reason-group {
            display: none;
        }
        #result-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            background-color: #e2f0d9; /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù„Ù„Ù†ØªØ§Ø¦Ø¬ */
            border: 1px solid #c3e6cb;
            white-space: pre-wrap; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙˆØ§Ù„Ø³Ø·ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
</head>
<body>

<div class="container">
    <h1>ğŸ“ Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ø¹ØªØ°Ø§Ø±</h1>

    <form id="attendance-form">
        <label for="volunteer-name">1. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³Ù…:</label>
        <select id="volunteer-name" required>
            <option value="">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>
            </select>

        <label for="status">2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©:</label>
        <select id="status" onchange="toggleReasonField()" required>
            <option value="">-- Ø­Ø¶ÙˆØ± Ø£Ùˆ Ø§Ø¹ØªØ°Ø§Ø± --</option>
            <option value="Ø­Ø¶ÙˆØ±">Ø­Ø¶ÙˆØ±</option>
            <option value="Ø§Ø¹ØªØ°Ø§Ø±">Ø§Ø¹ØªØ°Ø§Ø± Ø·Ø§Ø±Ø¦</option>
        </select>

        <div id="reason-group">
            <label for="reason">3. Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± (Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±):</label>
            <textarea id="reason" rows="3" placeholder="ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ ÙˆØ¬ÙŠÙ‡ Ù„Ù„Ø§Ø¹ØªØ°Ø§Ø±..."></textarea>
        </div>

        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</button>
    </form>

    <div id="result-area" style="display: none;"></div>
</div>

<script>
    // âš ï¸ Ù…ÙØ§ØªÙŠØ­ Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø¹Ø§Ù…Ù„ (rdtt-15cbe) - Ù†ÙØ³ Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    const firebaseConfig = {
        apiKey: "AIzaSyCDJANXMfd6TR7R2ruLIi-xytlrB-LiCEs",
        authDomain: "rdtt-15cbe.firebaseapp.com",
        projectId: "rdtt-15cbe",
        storageBucket: "rdtt-15cbe.firebasestorage.app",
        messagingSenderId: "219502671343",
        appId: "1:219502671343:web:b289b11869e25c9a30321a"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Firestore
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ----------------------------------------------------------------
    // 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ©
    // ----------------------------------------------------------------
    const WORKING_DAYS = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"];
    const ALL_WORKING_DAYS = WORKING_DAYS; 

    const FIXED_VOLUNTEERS = {
        "Ø£Ø­Ù…Ø¯": ALL_WORKING_DAYS.filter(day => day !== "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡" && day !== "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"),
        "Ù‡Ø¯ÙŠØ±": ALL_WORKING_DAYS,
        "Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": ALL_WORKING_DAYS,
        "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯": ALL_WORKING_DAYS.filter(day => day !== "Ø§Ù„Ø£Ø­Ø¯"),
        // ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø³Ø§Ù…ÙŠØŒ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·:
        "Ø³Ø§Ù…ÙŠ": ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"],
        "Ù…Ù…ØªØ§Ø²": ALL_WORKING_DAYS,
        "Ø­Ø¨ÙŠØ¨Ø©": ALL_WORKING_DAYS, // âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† 'Ø­Ø¨ÙŠØ¨Ù‡' Ø¥Ù„Ù‰ 'Ø­Ø¨ÙŠØ¨Ø©'
        "Ø³Ø§Ù†Ø¯ÙŠ": ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"], // âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† 'Ø³Ø§Ù†Ø¯Ù‰' Ø¥Ù„Ù‰ 'Ø³Ø§Ù†Ø¯ÙŠ'
        "Ø±Ø­Ø§Ø¨": ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡"],
        "Ù…Ø¹Ø§Ø°": ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³"],
        "ÙŠÙˆØ³Ù": ALL_WORKING_DAYS.filter(day => day !== "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡" && day !== "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡"),
        "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": ALL_WORKING_DAYS,
        "Ù…Ø±ÙˆØ§Ù†": ALL_WORKING_DAYS,
        "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†": ALL_WORKING_DAYS.filter(day => day !== "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†" && day !== "Ø§Ù„Ø®Ù…ÙŠØ³")
    };
    
    // ----------------------------------------------------------------
    // 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    // ----------------------------------------------------------------

    // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    function populateNameDropdown() {
        const select = document.getElementById('volunteer-name');
        const names = Object.keys(FIXED_VOLUNTEERS).sort(); 
        
        names.forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
        });
    }

    // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¨Ø¨ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±
    function toggleReasonField() {
        const status = document.getElementById('status').value;
        const reasonGroup = document.getElementById('reason-group');
        const reasonTextarea = document.getElementById('reason');

        if (status === 'Ø§Ø¹ØªØ°Ø§Ø±') {
            reasonGroup.style.display = 'block';
            reasonTextarea.setAttribute('required', 'required');
        } else {
            reasonGroup.style.display = 'none';
            reasonTextarea.removeAttribute('required');
        }
    }

    // ----------------------------------------------------------------
    // 3. ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ)
    // ----------------------------------------------------------------
    function displayConfirmation(name, status, days, reason, registrationTime) {
        let confirmationMessage = '';
        
        if (status === 'Ø­Ø¶ÙˆØ±') {
            confirmationMessage = `
ğŸ“Œ Ø­Ø¶ÙˆØ± Ù…ØªØ·ÙˆØ¹ 

Ø§Ù„Ø§Ø³Ù…: ${name}
Ø§Ù„Ø­Ø§Ù„Ø©: Ø­Ø¶ÙˆØ±
Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${days.join('ØŒ ')}
ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${registrationTime}

---
ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ…ï¸
`;
        } else if (status === 'Ø§Ø¹ØªØ°Ø§Ø±') {
            confirmationMessage = `
ğŸ“Œ Ø§Ø¹ØªØ°Ø§Ø± Ù…ØªØ·ÙˆØ¹ 

Ø§Ù„Ø§Ø³Ù…: ${name}
Ø§Ù„Ø­Ø§Ù„Ø©: Ø§Ø¹ØªØ°Ø§Ø± Ø·Ø§Ø±Ø¦
Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${days.join('ØŒ ')}
ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${registrationTime}
Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±: ${reason}

---
ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± ÙÙ‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ…ï¸
`;
        }

        const resultArea = document.getElementById('result-area');
        resultArea.textContent = confirmationMessage.trim();
        resultArea.style.display = 'block';
    }


    // ----------------------------------------------------------------
    // 4. ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ Firebase
    // ----------------------------------------------------------------
    document.getElementById('attendance-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const name = document.getElementById('volunteer-name').value;
        const status = document.getElementById('status').value;
        const reason = document.getElementById('reason').value || '';
        // ÙŠØ¬Ø¨ Ø£Ù† Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ FIXED_VOLUNTEERS
        const days = FIXED_VOLUNTEERS[name] || []; 
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
        if (status === 'Ø§Ø¹ØªØ°Ø§Ø±' && !reason.trim()) {
             alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± Ø£ÙˆÙ„Ø§Ù‹.");
             return;
        }
        if (!name || !status) return;

        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        const now = new Date();
        const dateString = now.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long', year: 'numeric' });
        const timeString = now.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit', hour12: true });
        const registrationTime = `${dateString} â€“ ${timeString}`;
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ (Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯_Ø§Ù„Ø³Ø¨Øª) Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…
        const todayDayName = now.toLocaleDateString('ar-EG', { weekday: 'long' });
        let docIdDay = todayDayName;
        const docId = `${name}_${docIdDay}`;

        try {
            await db.collection("user_attendance").doc(docId).set({
                volunteerName: name,
                status: status,
                reason: reason,
                day: docIdDay,
                registrationTime: registrationTime
            });

            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            displayConfirmation(name, status, days, reason, registrationTime);

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­
            document.getElementById('attendance-form').reset();
            toggleReasonField();
            
        } catch (error) {
            const resultArea = document.getElementById('result-area');
            resultArea.textContent = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`;
            resultArea.style.backgroundColor = '#f8d7da'; 
            resultArea.style.borderColor = '#f5c6cb';
            resultArea.style.display = 'block';
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
        }
    });

    // ØªØ´ØºÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = () => {
        populateNameDropdown();
        toggleReasonField();
    };

</script>

</body>
</html>
